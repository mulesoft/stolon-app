registry: "leader.telekube.local:5000/"

persistence:
  enabled: false

serviceMonitor:
  enabled: true

keeper:
  replicaCount: 3
  nodeSelector:
    stolon-keeper: "yes"
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: component
                operator: In
                values:
                  - stolon-keeper
          topologyKey: kubernetes.io/hostname

sentinel:
  replicaCount: 3
  nodeSelector:
    stolon-keeper: "yes"
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: component
                  operator: In
                  values:
                    - stolon-sentinel
            topologyKey: kubernetes.io/hostname

proxy:
  replicaCount: 3
  nodeSelector:
    stolon-keeper: "yes"
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: component
                  operator: In
                  values:
                    - stolon-proxy
            topologyKey: kubernetes.io/hostname

clusterSpec:
  requestTimeout: "60s"
  failInterval: "60s"
  deadKeeperRemovalInterval: "48h"
  maxStandbyLag: 16777216
  usePgrewind: true
  maxStandbys: 5
  pgHBA:
    - "hostssl all all 0.0.0.0/0 md5"
    - "hostssl all all ::0/0 md5"

pgParameters:
  idle_in_transaction_session_timeout: "10min"
  log_destination: "stderr"
  log_min_messages: "INFO"
  log_checkpoints: "on"
  log_min_duration_statement: "1s"
  log_lock_waits: "on"
  log_line_prefix: "%m [%p]: [%l-1] user=%u,db=%d "
  wal_keep_segments: "128"
  max_connections: "500"
  # generated based on Mozilla recommendations
  # https://ssl-config.mozilla.org/#server=postgresql&version=12.1&config=intermediate&openssl=1.1.0l&guideline=5.6
  ssl_min_protocol_version: "TLSv1.2"
  ssl_ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"
  ssl_ca_file: "/home/stolon/secrets/cluster-ca/ca.pem"
  ssl_cert_file: "/home/stolon/secrets/cluster-default/default-server-with-chain.pem"
  ssl_key_file: "/home/stolon/secrets/cluster-default/default-server-key.pem"
  ssl: "on"

tls:
  enabled: true
